{% extends "dashboard.html" %}
{% load static %} {# Make sure to load static files #}

{% block title %}Time Off Requests{% endblock %}
{% block page_title %}Manage Time Off Requests{% endblock %}

{% block breadcrumb_items %}
<li aria-current="page">
    <div class="flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 text-gray-400" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
        <span class="ml-1 text-xs font-semibold text-blue-600 md:ml-2">My Requests</span>
    </div>
</li>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto bg-white p-6 rounded-lg shadow-lg">
    <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Past Time Off Request History</h1>

    <div class="bg-gray-50 shadow-sm rounded-lg p-6 mb-8 border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-700 mb-4">Filter Leave History</h2>
        <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-4">
            <label for="payPeriodSelect" class="block text-sm font-medium text-gray-700 md:w-auto">Select Pay Period:</label>
            <select id="payPeriodSelect" name="pay_period_id"
                class="block w-full md:w-1/3 py-2 px-3 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                <option value="">Loading Pay Periods...</option> {# Initial loading state #}
            </select>
            <button id="filterButton"
                class="w-full md:w-auto px-5 py-2 bg-blue-600 text-white font-semibold rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition ease-in-out duration-150">
                Apply Filter
            </button>
        </div>
    </div>

    <div class="bg-gray-50 shadow-sm rounded-lg p-6 border border-gray-200">
        <h2 class="text-xl font-semibold text-gray-700 mb-4">Detailed Past Requests</h2>
        <div class="overflow-x-auto shadow ring-1 ring-black ring-opacity-5 rounded-lg">
            <table class="min-w-full divide-y divide-gray-300">
                <thead class="bg-gray-100">
                    <tr>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                            Department
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                            Leave Type
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                            Start Date/Time
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                            End Date/Time
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                            Total Hours
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                            Reason
                        </th>
                        <th scope="col"
                            class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">
                            Status
                        </th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200" id="ptoRequestsTableBody">
                    {# Dynamic rows will be inserted here by JavaScript #}
                    <tr id="noRequestsMessage" class="hidden">
                        <td colspan="7" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">No past
                            PTO requests found for the selected pay period.</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

{# Toast container for messages #}
<div id="toast-container" class="fixed top-5 right-5 z-50 space-y-2"></div>

{# Link the main JavaScript file #}
<script type="module" src="{% static 'ptorequest/js/past_pto_list.js' %}"></script>

{# Add any custom styles for status colors and potential row highlights #}
<style>
    /* Status text colors (for consistency) */
    .text-green-600 { color: #059669; }
    .text-yellow-600 { color: #d97706; }
    .text-red-600 { color: #dc2626; }

    /* Row highlight classes added by JS */
    .bg-green-50\/50 { background-color: rgba(220, 252, 231, 0.5); /* green-50 with 50% opacity */ }
    .bg-yellow-50\/50 { background-color: rgba(254, 252, 232, 0.5); /* yellow-50 with 50% opacity */ }
    .bg-red-50\/50 { background-color: rgba(254, 242, 242, 0.5); /* red-50 with 50% opacity */ }

    /* Hover effects for highlighted rows */
    .hover\:bg-green-100:hover { background-color: #d1fae5; }
    .hover\:bg-yellow-100:hover { background-color: #fefce8; }
    .hover\:bg-red-100:hover { background-color: #fee2e2; }

    /* For truncating long reason text */
    .max-w-xs {
        max-width: 15rem; /* Adjust as needed */
        white-space: normal;
        overflow: hidden;
        text-overflow: ellipsis;
        display: -webkit-box;
        -webkit-line-clamp: 2; /* Limit to 2 lines */
        -webkit-box-orient: vertical;
    }
</style>
{% endblock %}