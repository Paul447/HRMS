{% comment %} {% extends "dashboard.html" %}
{% load static %}

{% block title %}View Users{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto p-6 bg-white rounded-lg shadow-md">
    <h3 class="text-2xl font-semibold text-gray-800 border-b pb-2 mb-6">All Registered Users</h3>

    <div id="users-table" class="overflow-x-auto"></div>
</div>

<script>
    const apiUrl = '/api/users/';
    const csrftoken = '{{ csrf_token }}';

    // Fetch all users
    async function fetchUsers() {
        const response = await fetch(apiUrl);
        const users = await response.json();
        renderUsers(users);
    }

    function renderUsers(users) {
        const tableDiv = document.getElementById('users-table');
        if (users.length === 0) {
            tableDiv.innerHTML = `<p class="text-gray-500">No users found.</p>`;
            return;
        }

        let rows = users.map(user => `
            <tr class="hover:bg-gray-50" data-id="${user.id}">
                <td class="py-2 px-4 border">${user.username}</td>
                <td class="py-2 px-4 border">${user.email}</td>
                <td class="py-2 px-4 border">${user.date_joined}</td>
                <td class="py-2 px-4 border">${user.is_staff ? 'Yes' : 'No'}</td>
                <td class="py-2 px-4 border">${user.is_superuser ? 'Yes' : 'No'}</td>
                <td class="py-2 px-4 border">
                    <button onclick="editUser(${user.id})" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs">Edit</button>
                    <button onclick="deleteUser(${user.id})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs ml-2">Delete</button>
                </td>
            </tr>
        `).join('');

        tableDiv.innerHTML = `
            <table class="min-w-full border border-gray-300 text-sm text-left">
                <thead class="bg-gray-100 text-gray-700">
                    <tr>
                        <th class="py-3 px-4 border">Username</th>
                        <th class="py-3 px-4 border">Email</th>
                        <th class="py-3 px-4 border">Date Joined</th>
                        <th class="py-3 px-4 border">Is Staff</th>
                        <th class="py-3 px-4 border">Is Superuser</th>
                        <th class="py-3 px-4 border">Actions</th>
                    </tr>
                </thead>
                <tbody>${rows}</tbody>
            </table>
        `;
    }

    async function deleteUser(userId) {
        if (!confirm('Are you sure you want to delete this user?')) return;

        const response = await fetch(`${apiUrl}${userId}/`, {
            method: 'DELETE',
            headers: {
                'X-CSRFToken': csrftoken,
            }
        });

        if (response.status === 204) {
            alert('User deleted.');
            fetchUsers();
        } else {
            alert('Failed to delete user.');
        }
    }

    function editUser(userId) {
        // Redirect to a separate edit page (you can also do a modal here)
        window.location.href = `/auth/edit-user/${userId}/`;
    }

    document.addEventListener('DOMContentLoaded', fetchUsers);
</script>
{% endblock %} {% endcomment %}
